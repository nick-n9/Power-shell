Sub UpdateSQLForecast()
    Dim ws As Worksheet
    Dim conn As Object
    Dim sql As String
    Dim forecastedId As String
    Dim i As Long
    Dim dbConnectionString As String
    Dim lastRow As Long
    Dim finalForecast As Variant
    Dim manualForecast As Variant
    Dim manualAddOn As Variant
    
    Set ws = ThisWorkbook.Sheets("Sheet1")
    forecastedId = Trim(ws.Range("J2").Value)
    
    If forecastedId = "" Then
        MsgBox "Please enter a ForecastedObjectId in J2.", vbExclamation, "Input Required"
        Exit Sub
    End If
    
    lastRow = ws.Cells(Rows.Count, 1).End(xlUp).Row

    If lastRow < 2 Then
        MsgBox "No valid data found in the sheet!", vbExclamation, "Error"
        Exit Sub
    End If

    For i = 2 To lastRow
        If ws.Cells(i, 1).Value = forecastedId Then
            manualForecast = ws.Cells(i, 5).Value
            manualAddOn = ws.Cells(i, 6).Value
            finalForecast = ws.Cells(i, 7).Value
            
            If IsEmpty(manualForecast) Then manualForecast = "NULL" Else manualForecast = "'" & Replace(manualForecast, "'", "''") & "'"
            If IsEmpty(manualAddOn) Then manualAddOn = "NULL" Else manualAddOn = manualAddOn
            If IsEmpty(finalForecast) Then
                MsgBox "Final Forecast is empty for the given ForecastedObjectId!", vbExclamation, "Error"
                Exit Sub
            End If
            
            On Error Resume Next
            Set conn = CreateObject("ADODB.Connection")
            dbConnectionString = "Provider=SQLOLEDB;Data Source=YOUR_SERVER;Initial Catalog=YOUR_DATABASE;Integrated Security=SSPI;"
            conn.Open dbConnectionString
            
            If conn.State = 0 Then
                MsgBox "Database connection failed!", vbCritical, "Error"
                Exit Sub
            End If
            
            sql = "UPDATE ForecastNew SET " & _
                  "ManualForecast = " & manualForecast & ", " & _
                  "ManualAddOn = " & manualAddOn & ", " & _
                  "FinalForecast = " & finalForecast & " " & _
                  "WHERE ForecastedObjectId = '" & Replace(forecastedId, "'", "''") & "'"
            
            conn.Execute sql
            
            conn.Close
            Set conn = Nothing
            
            MsgBox "SQL Table updated successfully for ID: " & forecastedId, vbInformation, "Update Successful"
            Exit Sub
        End If
    Next i

    MsgBox "ForecastedObjectId not found in the sheet!", vbExclamation, "Not Found"
End Sub
